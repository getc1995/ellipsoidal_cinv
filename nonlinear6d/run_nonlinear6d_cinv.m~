clear all
close all

addpath('../ellipsoidal_approximation')

dyn = get_nonlinear_6d_dyn;

verbose = true;
E_init.E = diag([0.1, 0.1, 0.1, 0.1, 0.1, 0.1].^2);
E_init.c = zeros(6,1);

ellip = getcinv_nonlinear6d(dyn, dyn.box, verbose, E_init);
volume = 1/sqrt(det(ellip.E));
disp(['E volume: ', num2str(volume)])
% E = getcinv(dyn, box, true, E_poly);

% plot_E_4d(E)
T = 100;
rd = zeros(1, T);
for i = 1:T
    d = rd(i);
    ellip = pre(ellip, dyn, d);
    
    [E, c] = polytope_intersect_sorted(box.A, box.b, ellip.E, ellip.c);
    ellip.E = E;
    ellip.c = c;
end
volume = 1/sqrt(det(ellip.E));
disp(['E volume: ', num2str(volume)])




